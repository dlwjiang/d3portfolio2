<!DOCTYPE html>
<html>
<head>

  <title>Bar Chart</title>

  <style type="text/css">

    svg {
      background-color: #fff;
    }

    body {
      margin:0px;
      font-family: 'Roboto', sans-serif;
    }

    #title-area {
      border-bottom: 2px solid #BBBBBB;
    }

    #title-area h1, #title-area h3{
      margin-left:30px;
    }

    .svg-group {
      /*outline: 1px dotted red;*/
    }

    #charts {
      font-size:0;
    }
    .chart {
      display:inline-block;
      vertical-align: top;
      width:50%;
      height: 100vh;
      /*width:100%;*/
      overflow:hidden;
    }

    /*
    Bar Chart Styles
     */

    rect {
      fill: #33AACF;
      rx: 5;
      ry: 5;
    }

    /*
    Axis Styles
     */

    .axis text {
      font: 10px sans-serif;
    }

    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }


  </style>

  <link href='http://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
  <link href='http://fonts.googleapis.com/css?family=Roboto:300' rel='stylesheet' type='text/css'>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="http://underscorejs.org/underscore-min.js"></script>

</head>
<body>

  <div id="title-area">
    <h1>Bar Chart</h1>
  </div>

  <!-- ======== -->
  <!-- Charts   -->
  <!-- ======== -->

  <div id="charts">
    <div id="chart-area" class="chart"></div>
    <div id="chart-area2" class="chart"></div>
  </div>

  <!-- ========== -->
  <!-- JAVASCRIPT -->
  <!-- ========== -->

  <script>

   var example1 = [
      {label: "apples", value: 10},
      {label: "oranges", value: 20},
      {label: "bananas", value: 30},
      {label: "durians", value: 20},
      {label: "watermelon", value: 30},
      {label: "grapefruit", value: 20},
      {label: "strawberries", value: 50}
   ];

   var example2 = [
      {label: "guitar", value: 100},
      {label: "ukulele", value: 200},
      {label: "piano", value: 300},
      {label: "flute", value: 400},
      {label: "drums", value: 500},
      {label: "trumpet", value: 600}
   ];

   var example3 = [
      {label: "apples", value: 44},
      {label: "oranges", value: 44},
      {label: "bananas", value: 22},
      {label: "durians", value: 11},
      {label: "watermelon", value: 55},
      {label: "grapefruit", value: 55},
      {label: "strawberries", value: 22},
      {label: "passionfruit", value: 22}
   ];

   chartData = [example1, example2, example3];

   var chart = barChart().data(chartData[0]).target("#chart-area");
   chart();

   setInterval(function (arguments) {
     var rand = Math.floor(Math.random()*3);
     chart.update(chartData[rand]);
   },1000)

   var chart2 = barChart().data(chartData[2]).target("#chart-area2");
   chart2();

   function barChart(){

      var margins = {left:50, top:50, right:50, bottom:50};

      var data = [1,2,3,4,5];
      var selection = null;

      function draw(newData){

        if (newData) {
          data = newData;
        }

        var width = $(selection).width() - margins.left - margins.right;
        var height = $(selection).height() * 0.8 - margins.top - margins.bottom;
        var columnCount = data.length;

        var yValMax = d3.max(data, function (each) {
          return each.value;
        })

        /*=================================
        =       Setup & Scales            =
        ==================================*/

        var xScale = d3.scale.ordinal()
                       .domain(_.pluck(data, "label"))
                       .rangeRoundBands([0,width],0.2,0.4);

        var xAxis = d3.svg.axis()
                      .orient("bottom")
                      .scale(xScale);

        var yScale = d3.scale.linear()
                       .domain([0,yValMax])
                       .range([height,0]);

        var yAxis = d3.svg.axis()
                          .orient("left")
                          .scale(yScale);

        var svg = d3.select(selection)
                    .append("svg")
                    .attr("width", width + margins.left + margins.right)
                    .attr("height", height + margins.top + margins.bottom)
                   .append("g")
                    .attr("class", "svg-group")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("transform", "translate(" + margins.left + "," + margins.top + ")");

        var xAxisGroup = svg.append("g")
                            .attr("class", "x axis")
                            .attr("transform", "translate(0," + height + ")")
                            .call(xAxis);

        _rotateXLabels();

        var yAxisGroup = svg.append("g").attr("class", "y axis").call(yAxis);

        /*============================
        =            Bars            =
        ============================*/

        var barGroups = svg.selectAll("g.bars")
                          .data(data,function (d) {
                            return d.label;
                          })
                          .enter()
                          .append("g")
                          .attr("class", "bars")
                          .attr("transform", function (d,i) {
                            return "translate(" + xScale(d.label) + ",0)";
                          });

        var bars = barGroups.append("rect")
                            .attr("y",function (d) {
                              return yScale(d.value);
                            })
                            .attr("height", function (d) {
                              return height - yScale(d.value);
                            })
                            .attr("width", xScale.rangeBand());

        var text = barGroups.append("text")
                            .attr("y", function (d) {
                              return yScale(d.value) - 5;
                            })
                            .attr("font-size","10px")
                            .attr("fill", "#888")
                            .text(function(d) { return d.label; });


        /*========================================
        =            Helper Functions            =
        ========================================*/
        var update = function (newData) {

          if (newData) data = newData;

          var yValMax = d3.max(data, function (each) {
            return each.value;
          })

          /*==================================
          =            Update SVG            =
          ==================================*/

          var newWidth = $(selection).width();
          var newHeight = $(selection).height() * 0.8;

          //set minimum width/height
          minLength = 200;
          newWidth = newWidth > minLength ? newWidth: minLength;
          newHeight = newHeight > minLength ? newHeight: minLength;

          width = newWidth - margins.left - margins.right;
          height = newHeight - margins.top - margins.bottom;

          d3.select(selection + " svg")
            .attr("width", width + margins.left + margins.right)
            .attr("height", height + margins.top + margins.bottom)

          d3.select(selection + ".svg-group")
            .attr("width", width)
            .attr("height", height)
            .attr("transform", "translate(" + margins.left + "," + margins.top + ")");

          /*=================================
          =       Update Scales             =
          ==================================*/
          xScale.domain(_.pluck(data, "label"));
          xScale.rangeRoundBands([0,width],0.2,0.4);
          xAxis.scale(xScale);

          yScale.domain([0,yValMax]);
          yScale.range([height,0]);
          yAxis.scale(yScale);

          xAxisGroup.attr("transform", "translate(0," + height + ")")
                    .call(xAxis);

          _rotateXLabels();

          yAxisGroup.call(yAxis);

          /*============================
          =      Update Bars           =
          ============================*/
          var newGroups = svg.selectAll("g.bars")
                          .data(data, function (d) {
                            return d.label;
                          });
          //EXIT
          //=================================
          newGroups.exit()
            .transition().duration(500)
             .attr('transform', "translate(-1000,0)")
             .remove();

          //UPDATE
          //=================================
          newGroups.transition().duration(200)
                .attr("transform", function (d,i) {
                  return "translate(" + xScale(d.label) + ",0)";
                });

          newGroups.select("rect")
              .transition().duration(200)
              .attr("y",function (d) {
                return yScale(d.value);
              })
              .attr("height", function (d) {
                return height - yScale(d.value);
              })
              .attr("width", xScale.rangeBand());

          newGroups.select("text")
              .transition().duration(200)
              .attr("y",function (d) {
                return yScale(d.value) - 5;
              })

          //ENTER
          //=================================
          var enterGroup = newGroups.enter()
                  .append("g")
                  .attr("class", "bars");

          //add rects
          enterGroup
              .append("rect")
              .attr("y",function (d) {
                return yScale(d.value);
              })
              .attr("height", function (d) {
                return height - yScale(d.value);
              })
              .attr("width", xScale.rangeBand());
              // .attr("fill", "#888");

          //add labels
          enterGroup.append("text")
                    .attr("y", function (d) {
                      return yScale(d.value) - 5;
                    })
                    .attr("font-size","10px")
                    .attr("fill", "#888")
                    .text(function(d) { return d.label; });

          //transition groups in from right to left
          enterGroup.attr("transform", function (d,i) {
                        return "translate(2000,0)";
                      })
                    .transition().duration(500)
                      .attr("transform", function (d,i) {
                        return "translate(" + xScale(d.label) + ",0)";
                      })

        }

        function _rotateXLabels() {
          if (width < 800) {
            xAxisGroup.selectAll("text")
                      .attr("dy", ".35em")
                      .attr("transform", "rotate(40)")
                      .style("text-anchor", "start");
          }
        }

        draw.update = update;

      }

      draw.data = function(value) {
          if (!arguments.length) return data;
          data = value;
          return draw;
      };

      draw.target = function (value) {
          if (!arguments.length) return selection;
          selection = value;
          return draw;
      }

      draw.replaceChart = function (newData) {
        $(selection).empty();
        draw(newData);
      };

      $(window).on("resize",_.debounce(function () {
         draw.update();
      },200));

      return draw;
   }

  </script>

</body>
</html>